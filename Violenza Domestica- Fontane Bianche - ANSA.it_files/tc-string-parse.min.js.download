"use strict";!function(e,n){"function"==typeof define&&define.amd?define([],n):"object"==typeof module&&module.exports?module.exports=n():e.TCStringParse=n()}("undefined"==typeof self?this:self,function(){function p(e){return parseInt(e,2)||0}function f(e){if("string"!=typeof e)throw new Error("Invalid transparency and consent string specified");for(var n=e.split("."),r=[],t=0,s=n.length;t<s;t+=1)r.push(function(e){for(var n="",r=0,t=e.length;r<t;r+=1){var s=e.charCodeAt(r).toString(2);n+="00000000".slice(0,8-s.length)+s}return n}(function(e){if("function"==typeof atob){var n=e.replace(/_/g,"/").replace(/-/g,"+");try{return atob(n)}catch(e){throw new Error("Unable to decode transparency and consent string")}}if("function"==typeof Buffer)return Buffer.from(e,"base64").toString("binary");throw new Error("Unable to detect base64 decoder")}(n[t])));var o=p(r[0].slice(0,6));if(2!==o)throw new Error("Unsupported transparency and consent string version “"+o+"”");return r}var k=function(e){return 100*p(e)},l=function(e){for(var n="A".charCodeAt(),r=e.match(/.{6}/g)||[],t="",s=0,o=r.length;s<o;s+=1){var i=p(r[s])+n;t+=String.fromCharCode(i)}return t},g=function(e){return Boolean(Number(e))},m=function(e){for(var n=e.split(""),r={},t=0,s=n.length;t<s;t+=1)g(n[t])&&(r[t+1]=!0);return r};return function(u){function i(n,e,r,t){function s(){if(t.pubRestrictionEntry&&t.rangeEntry)for(var e in t.rangeEntry)Object.prototype.hasOwnProperty.call(t.rangeEntry,e)&&(t.pubRestrictionEntry[e]=(t.pubRestrictionEntry[e]||[]).concat(t.rangeEntry[e]));t.numPubRestrictions&&(--t.numPubRestrictions,n.push({key:"purposeId",size:6},{key:"restrictionType",size:2},{key:"numEntries",size:12}))}function o(){t.numEntries?(--t.numEntries,n.push({key:"isRange",size:1,decoder:g},{key:"startVendorId",size:16})):s()}function i(){return!t.purposeId||[{purpose:t.purposeId,isAllowed:0!==t.restrictionType,isConsentRequired:1===t.restrictionType,isLegitimateInterestRequired:2===t.restrictionType}]}if("isRangeEncoding"===e.key)n.push(r?{key:"numEntries",size:12}:{key:"bitField",size:t.maxVendorId,decoder:m});else if("numEntries"===e.key)t.rangeEntry={},o();else if("isRange"===e.key)r&&n.push({key:"endVendorId",size:16});else if("startVendorId"===e.key)t.isRange||(t.rangeEntry[r]=i(),o());else if("endVendorId"===e.key){for(var u=t.startVendorId;u<=t.endVendorId;u+=1)t.rangeEntry[u]=i();o()}else"numCustomPurposes"===e.key?n.push({key:"customPurposeConsents",size:t.numCustomPurposes,decoder:m},{key:"customPurposeLegitimateInterests",size:t.numCustomPurposes,decoder:m}):"numPubRestrictions"===e.key&&(t.pubRestrictionEntry={},s())}function c(e){return e.pubRestrictionEntry||e.rangeEntry||e.bitField||e}function d(e,n){var r=n.slice(y,y+e.size);return y+=e.size,(e.decoder||p)(r)}function a(e,n){for(var r={},t=0;t<e.queue.length;t+=1){var s=e.queue[t],o=function(e,n){if(!e.queue)return d(e,n);for(var r={},t=0;t<e.queue.length;t+=1){var s=e.queue[t],o=d(s,n);s.key&&(r[s.key]=o),i(e.queue,s,o,r)}return c(r)}(s,n);s.key&&(r[s.key]=o),i(e.queue,s,o,r)}return c(r)}var y=0;return function(){for(var e=f(u),n=function(e){for(var n=[{key:"purposeConsents",size:24,decoder:m},{key:"purposeLegitimateInterests",size:24,decoder:m}],r=[{key:"maxVendorId",size:16},{key:"isRangeEncoding",size:1,decoder:g}],t=[{key:"version",size:6},{key:"created",size:36,decoder:k},{key:"lastUpdated",size:36,decoder:k},{key:"cmpId",size:12},{key:"cmpVersion",size:12},{key:"consentScreen",size:6},{key:"consentLanguage",size:12,decoder:l},{key:"vendorListVersion",size:12},{key:"policyVersion",size:6},{key:"isServiceSpecified",size:1,decoder:g},{key:"useNonStandardStacks",size:1,decoder:g},{key:"specialFeatureOptins",size:12,decoder:m}].concat(n).concat({key:"purposeOneTreatment",size:1,decoder:g},{key:"publisherCountryCode",size:12,decoder:l},{key:"vendorConsents",queue:[{key:"maxVendorId",size:16},{key:"isRangeEncoding",size:1,decoder:g}]},{key:"vendorLegitimateInterests",queue:r},{key:"publisherRestrictions",queue:[{key:"numPubRestrictions",size:12}]}),s=[{size:3}],o=[].concat(s).concat(r),i=[].concat(s).concat(r),u=[].concat(s).concat(n).concat({key:"numCustomPurposes",size:6}),c=[{key:"core",queue:t}],d=1;d<e.length;d+=1){var a=e[d],y=p(a.slice(0,3));1===y?c.push({key:"disclosedVendors",queue:o}):2===y?c.push({key:"allowedVendors",queue:i}):3===y&&c.push({key:"publisherTC",queue:u})}return c}(e),r={},t=0;t<n.length;t+=1){var s=n[t],o=e[t],i=a(s,o);s.key&&(r[s.key]=i),y=0}return r}()}});
